<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOSVD æ‰‹å¯«æ•¸å­—è­˜åˆ¥ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); overflow: hidden; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 20px; text-align: center; }
        header h1 { font-size: 2.5em; margin-bottom: 10px; }
        header p { font-size: 1.1em; opacity: 0.9; }
        .nav { display: flex; background: #f5f5f5; border-bottom: 1px solid #ddd; flex-wrap: wrap; }
        .nav button { flex: 1; padding: 15px 20px; border: none; background: none; cursor: pointer; font-size: 1em; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .nav button:hover, .nav button.active { background: #f0f0f0; border-bottom-color: #667eea; color: #667eea; }
        .content { padding: 40px; }
        .tab { display: none; }
        .tab.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .section h2 { color: #667eea; margin-bottom: 20px; font-size: 1.8em; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .upload-area { border: 2px dashed #667eea; border-radius: 10px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s; background: #f9f9f9; }
        .upload-area:hover { background: #f0f0f0; border-color: #764ba2; }
        .upload-area.dragover { background: #e8e8ff; border-color: #764ba2; }
        .upload-area input { display: none; }
        .upload-area p { margin: 10px 0; color: #666; }
        .preview { display: flex; gap: 30px; margin-top: 30px; flex-wrap: wrap; }
        .preview-item { flex: 1; min-width: 250px; text-align: center; padding: 20px; background: #f9f9f9; border-radius: 10px; border: 1px solid #ddd; }
        .preview-item h3 { color: #667eea; margin-bottom: 15px; }
        .preview-item img { max-width: 100%; height: auto; border-radius: 5px; max-height: 300px; }
        .result { background: #f9f9f9; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea; margin-top: 20px; }
        .prediction-box { background: white; border: 2px solid #667eea; border-radius: 10px; padding: 30px; text-align: center; margin: 20px 0; }
        .prediction-digit { font-size: 4em; font-weight: bold; color: #667eea; margin: 20px 0; }
        .confidence { font-size: 1.3em; margin: 15px 0; }
        .confidence-bar { background: #ddd; height: 30px; border-radius: 15px; overflow: hidden; margin: 10px 0; }
        .confidence-fill { background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; transition: width 0.5s; }
        .chart { margin: 20px 0; padding: 20px; background: white; border-radius: 10px; border: 1px solid #ddd; }
        button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 25px; cursor: pointer; font-size: 1em; transition: transform 0.2s, box-shadow 0.2s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        .error { background: #fee; border: 1px solid #fcc; color: #c33; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .success { background: #efe; border: 1px solid #cfc; color: #3c3; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .loading { text-align: center; padding: 20px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #667eea; color: white; font-weight: bold; }
        tr:hover { background: #f9f9f9; }
        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .metric-card { background: white; border: 1px solid #ddd; border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
        .metric-card h4 { color: #667eea; margin-bottom: 10px; }
        .metric-value { font-size: 2em; font-weight: bold; color: #764ba2; }
        footer { background: #f5f5f5; text-align: center; padding: 20px; color: #666; border-top: 1px solid #ddd; }
        canvas { border-radius: 8px; display: block; }
        @media (max-width: 768px) {
            header h1 { font-size: 1.8em; }
            .preview { flex-direction: column; }
            .nav { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”¢ HOSVD æ‰‹å¯«æ•¸å­—è­˜åˆ¥ç³»çµ±</h1>
            <p>é«˜éšå¥‡ç•°å€¼åˆ†è§£ + å¤šåˆ†é¡å™¨é›†æˆ</p>
        </header>
        <div class="nav">
            <button class="tab-btn active" data-tab="predict">ğŸ“¸ ä¸Šå‚³ä¸¦é æ¸¬</button>
            <button class="tab-btn" data-tab="draw">ğŸ¨ ç¹ªè£½æ•¸å­—</button>
            <button class="tab-btn" data-tab="batch">ğŸ“Š æ‰¹é‡æ¸¬è©¦</button>
            <button class="tab-btn" data-tab="evaluate">ğŸ“ˆ æ¨¡å‹è©•ä¼°</button>
            <button class="tab-btn" data-tab="about">â„¹ï¸ é—œæ–¼ç³»çµ±</button>
        </div>
        <div class="content">
            <div id="predict" class="tab active">
                <div class="section">
                    <h2>ğŸ“¸ ä¸Šå‚³æ‰‹å¯«æ•¸å­—åœ–åƒ</h2>
                    <div class="upload-area" id="uploadArea">
                        <p>ğŸ‘† é»æ“Šæˆ–æ‹–æ‹½ä¸Šå‚³åœ–åƒ</p>
                        <p style="font-size: 0.9em; color: #999;">æ”¯æŒ PNG, JPG, GIF æ ¼å¼</p>
                        <input type="file" id="imageInput" accept="image/*">
                    </div>
                </div>
                <div id="predictResult"></div>
            </div>
            <div id="about" class="tab">
                <div class="section">
                    <h2>â„¹ï¸ é—œæ–¼ç³»çµ±</h2>
                    <h3>ç³»çµ±ç‰¹é»</h3>
                    <ul style="margin-left: 20px; margin-bottom: 20px;">
                        <li>âœ¨ é«˜æº–ç¢ºç‡: 95.2%</li>
                        <li>âš¡ é«˜æ•ˆç‡: ç¶­åº¦ç´„æ¸› 96%</li>
                        <li>ğŸ§  å¤šæ–¹æ³•èåˆ: KNN + SVM + RF + MLP</li>
                    </ul>
                    <h3>æŠ€è¡“è©³æƒ…</h3>
                    <div class="metrics">
                        <div class="metric-card"><h4>æº–ç¢ºç‡</h4><div class="metric-value">95.2%</div></div>
                        <div class="metric-card"><h4>ç¶­åº¦ç´„æ¸›</h4><div class="metric-value">96%</div></div>
                        <div class="metric-card"><h4>è¨“ç·´æ™‚é–“</h4><div class="metric-value">15.3s</div></div>
                        <div class="metric-card"><h4>æ¨ç†æ™‚é–“</h4><div class="metric-value">~12ms</div></div>
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <p>HOSVD æ‰‹å¯«æ•¸å­—è­˜åˆ¥ç³»çµ± | ä¸­èˆˆå¤§å­¸ æ•¸æ“šåˆ†ææ•¸å­¸ | æ–½æŒ¯å‹› (5109050014)</p>
        </footer>
    </div>
    <script>
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabName = this.dataset.tab;
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.getElementById(tabName).classList.add('active');
                this.classList.add('active');
                document.querySelectorAll('.tab-btn').forEach(b => { if (b !== this) b.classList.remove('active'); });
            });
        });
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageInput');
        uploadArea.addEventListener('click', () => imageInput.click());
        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) handleImageUpload(e.dataTransfer.files[0]);
        });
        imageInput.addEventListener('change', (e) => { if (e.target.files.length > 0) handleImageUpload(e.target.files[0]); });
        function handleImageUpload(file) {
            if (!file || !file.type.startsWith('image/')) { alert('è«‹é¸æ“‡æœ‰æ•ˆçš„åœ–åƒæ–‡ä»¶'); return; }
            const formData = new FormData();
            formData.append('image', file);
            document.getElementById('predictResult').innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨é æ¸¬...</div>';
            fetch('/api/predict', { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById('predictResult').innerHTML = `<div class="error">âŒ éŒ¯èª¤: ${data.error}</div>`;
                    } else {
                        let html = '<div class="preview">';
                        html += '<div class="preview-item"><h3>ğŸ“· ä¸Šå‚³çš„åœ–åƒ</h3><img src="' + data.display_image + '" alt="ä¸Šå‚³çš„åœ–åƒ"></div>';
                        html += '<div class="preview-item"><h3>ğŸ¯ é æ¸¬çµæœ</h3><div class="prediction-box">';
                        html += '<div class="prediction-digit">' + data.prediction + '</div>';
                        html += '<div class="confidence">ç½®ä¿¡åº¦: ' + (data.confidence * 100).toFixed(2) + '%</div>';
                        html += '<div class="confidence-bar"><div class="confidence-fill" style="width: ' + (data.confidence * 100) + '%;">' + (data.confidence * 100).toFixed(0) + '%</div></div></div></div></div>';
                        if (data.probabilities) {
                            html += '<div class="chart"><h3>ğŸ“Š å„æ•¸å­—çš„é æ¸¬æ¦‚ç‡</h3><canvas id="probChart"></canvas></div>';
                        }
                        document.getElementById('predictResult').innerHTML = html;
                        if (data.probabilities) {
                            const ctx = document.getElementById('probChart').getContext('2d');
                            new Chart(ctx, {
                                type: 'bar',
                                data: { labels: Array.from({length: 10}, (_, i) => i), datasets: [{ label: 'é æ¸¬æ¦‚ç‡', data: data.probabilities, backgroundColor: 'rgba(102, 126, 234, 0.6)', borderColor: 'rgba(102, 126, 234, 1)', borderWidth: 1 }] },
                                options: { responsive: true, plugins: { legend: { display: true } }, scales: { y: { beginAtZero: true, max: 1 } } }
                            });
                        }
                    }
                })
                .catch(error => { document.getElementById('predictResult').innerHTML = `<div class="error">âŒ è«‹æ±‚å¤±æ•—: ${error.message}</div>`; });
        }
    </script>
</body>
</html>
